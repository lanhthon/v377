<?php
// File: api/update_status_to_choxuatkho.php
// Cập nhật trạng thái đơn hàng thành "Chờ xuất kho"
require_once '../config/db_config.php';
session_start();
header('Content-Type: application/json');

$donhang_id = $_POST['donhang_id'] ?? 0;
$userId = $_SESSION['user_id'] ?? null;
$response = ['success' => false, 'message' => ''];

if (empty($donhang_id) || empty($userId)) {
    $response['message'] = 'Dữ liệu không hợp lệ hoặc bạn chưa đăng nhập.';
    echo json_encode($response);
    exit;
}

try {
    $pdo = get_db_connection();
    $sql = "UPDATE donhang SET TrangThai = 'Chờ xuất kho' WHERE YCSX_ID = ?";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$donhang_id]);

    if ($stmt->rowCount() > 0) {
        $response['success'] = true;
        $response['message'] = 'Đã cập nhật trạng thái đơn hàng thành "Chờ xuất kho".';
    } else {
        $response['message'] = 'Không có đơn hàng nào được cập nhật. Có thể đơn hàng không tồn tại hoặc đã ở trạng thái này.';
    }

} catch (Exception $e) {
    $response['message'] = 'Lỗi: ' . $e->getMessage();
}

echo json_encode($response);
?>
